# 网页镜像展示系统

一个基于 Node.js 和 Playwright 的网页镜像展示系统，可以抓取网页内容（包括 iframe）并创建可访问的镜像页面。

## 功能特性

- 🌐 **页面抓取**: 支持抓取任意网页内容
- 🖼️ **iframe 处理**: 自动检测并优先抓取 iframe 内容
- 🔗 **资源路径处理**: 自动转换相对路径为绝对路径
- 🛡️ **安全防护**: 内置 SSRF 防护和 URL 安全检查
- 📱 **友好界面**: 提供简洁的 Web 界面进行操作
- ⚡ **快速访问**: 通过短代码即可访问镜像页面

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 启动服务

```bash
npm start
```

服务将在 http://localhost:3000 启动。

### 3. 开发模式

```bash
npm run dev
```

使用 Node.js 的 `--watch` 模式，文件变化时自动重启。

## API 接口

### 1. 页面抓取

**请求**:
```
GET /fetch?u=<网页URL>
```

**响应**:
```json
{
  "code": "abcd1234",
  "iframe_url": "https://iframe.example.com",
  "preview_url": "http://localhost:3000/abcd1234"
}
```

### 2. 页面展示

**请求**:
```
GET /{代码}
```

**响应**: 返回完整的 HTML 页面内容

### 3. 健康检查

**请求**:
```
GET /health
```

**响应**:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

## 使用示例

### 通过 Web 界面

1. 访问 http://localhost:3000
2. 输入要抓取的网页 URL
3. 点击"创建镜像"
4. 获得镜像页面链接

### 通过 API

```bash
# 抓取页面
curl "http://localhost:3000/fetch?u=https://example.com"

# 访问镜像（假设返回代码为 abc123def456）
curl "http://localhost:3000/abc123def456"
```

## 工作原理

1. **接收请求**: 用户提供要抓取的网页 URL
2. **启动浏览器**: 使用 Playwright 启动 Chromium 浏览器
3. **访问页面**: 导航到目标页面并等待加载完成
4. **检测 iframe**: 如果页面包含 iframe，获取第一个 iframe 的内容
5. **处理资源**: 将相对路径转换为绝对路径
6. **保存内容**: 生成唯一代码并保存页面内容
7. **返回结果**: 提供访问镜像页面的链接

## 安全特性

- **URL 验证**: 只允许 HTTP/HTTPS 协议
- **内网防护**: 阻止访问本地和内网地址
- **代码验证**: 严格验证页面代码格式
- **超时控制**: 设置页面加载超时时间

## 目录结构

```
kimi/
├── src/
│   └── index.js          # 主服务文件
├── content/              # 存储镜像页面数据
├── test/
│   └── demo.js           # 测试脚本
├── package.json          # 项目配置
├── README.md            # 文档
└── prd.txt              # 产品需求文档
```

## 测试

运行测试脚本：

```bash
npm test
```

测试包括：
- 健康检查
- 页面抓取功能
- 页面展示功能
- iframe 处理
- 错误处理

## 注意事项

1. **依赖环境**: 需要安装 Playwright 浏览器依赖
2. **网络访问**: 某些网站可能有反爬虫机制
3. **资源消耗**: Playwright 会消耗较多系统资源
4. **存储空间**: 镜像内容存储在本地文件系统

## 扩展功能

可以考虑添加的功能：
- 批量抓取
- 定时更新
- 资源本地化存储
- 数据库存储
- 用户认证
- 访问统计

## 故障排除

### 常见问题

1. **浏览器启动失败**
   ```bash
   npx playwright install chromium
   ```

2. **端口被占用**
   - 修改 `src/index.js` 中的端口号
   - 或者终止占用端口的进程

3. **页面抓取失败**
   - 检查目标网站是否可访问
   - 确认网站没有反爬虫机制
   - 查看控制台错误日志

## 许可证

MIT License
